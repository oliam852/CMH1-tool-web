<!-- MADE By AYOUB RHATTOY CMH1 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML Fusion Editor CMH-1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.1",
    "react-dom/": "https://esm.sh/react-dom@^19.1.1/",
    "react/": "https://esm.sh/react@^19.1.1/"
  }
}
</script>
<style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #1a1b26; /* Dark background */
    }
    .font-mono {
        font-family: 'Roboto Mono', monospace;
    }
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    ::-webkit-scrollbar-track {
        background: #2a2c3d;
    }
    ::-webkit-scrollbar-thumb {
        background: #4a4e69;
        border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: #00f5c3;
    }
    .glow-focus:focus-within {
        box-shadow: 0 0 0 2px #1a1b26, 0 0 0 4px #00f5c3;
    }
    .glow-accent {
        box-shadow: 0 0 15px -2px rgba(0, 245, 195, 0.4);
    }
</style>
</head>
<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect, useCallback, useRef, memo } = React;

// START: components/icons/EditorIcons.tsx
const HeartIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
  </svg>
);

const PlusIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" />
  </svg>
);

const HistoryIcon = ({ className = 'w-6 h-6' }) => ( // Undo
    <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
);

const RotateCwIcon = ({ className = 'w-6 h-6' }) => ( // Redo
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M21 12a9 9 0 1 1-6.74-8.74L21 8"/><path d="M21 3v5h-5"/>
  </svg>
);


const SaveIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" />
  </svg>
);

const CopyIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <rect x="9" y="9" width="13" height="13" rx="2" ry="2" /><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
  </svg>
);

const CheckIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <polyline points="20 6 9 17 4 12" />
  </svg>
);

const Trash2Icon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" />
  </svg>
);

const ExpandIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" />
  </svg>
);

const MinimizeIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/>
    </svg>
);

const SettingsIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 7h-9"/><path d="M14 17H5"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></svg>
);

const UploadIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" />
  </svg>
);

const LinkIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72" />
  </svg>
);

const SlidersIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <line x1="4" y1="21" x2="4" y2="14" /><line x1="4" y1="10" x2="4" y2="3" /><line x1="12" y1="21" x2="12" y2="12" /><line x1="12" y1="8" x2="12" y2="3" /><line x1="20" y1="21" x2="20" y2="16" /><line x1="20" y1="12" x2="20" y2="3" /><line x1="1" y1="14" x2="7" y2="14" /><line x1="9" y1="8" x2="15" y2="8" /><line x1="17" y1="16" x2="23" y2="16" />
  </svg>
);

const PlayIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <polygon points="5 3 19 12 5 21 5 3" />
  </svg>
);

const ListMinusIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M11 12H3" /><path d="M16 6H3" /><path d="M16 18H3" /><path d="M21 12h-6" />
  </svg>
);

const DownloadIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" />
  </svg>
);

const MailIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
    <polyline points="22,6 12,13 2,6" />
  </svg>
);

const TypeIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <polyline points="4 7 4 4 20 4 20 7"></polyline>
      <line x1="9" y1="20" x2="15" y2="20"></line>
      <line x1="12" y1="4" x2="12" y2="20"></line>
  </svg>
);

const RefreshCwIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
      <polyline points="23 4 23 10 17 10"></polyline>
      <polyline points="1 20 1 14 7 14"></polyline>
      <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
  </svg>
);

const ToolIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
);

const FileIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
);

const WandIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M15 4V2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-2"></path><path d="M15 12h5a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2Z"></path></svg>
);

const CodeIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
);

const XIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
);

const ChevronDownIcon = ({ className = 'w-5 h-5' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6 9 6 6 6-6"/></svg>
);

const TargetIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
);

const GlobeIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
);

const FileTextIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
);
// END: components/icons/EditorIcons.tsx


// START: constants.ts

const SAMPLE_HTML = `<!-- ADD HTML HERE OR Extract IPs , Domains , Encode / Decode -->`;
// END: constants.ts

// START: components/Header.tsx
const Header = memo(({ onNew, onDownload, onRun, onToggleTools }) => {
  return (
    <header className="flex items-center justify-between p-3 bg-[#1e1f2b] text-gray-200 border-b border-[#2a2c3d]">
      <div className="flex items-center gap-3">
        <div className="bg-gradient-to-tr from-[#00f5c3] to-[#00a1c3] p-2 rounded-lg">
            <CodeIcon className="w-6 h-6 text-[#1a1b26]" />
        </div>
        <h1 className="text-xl font-bold tracking-wider text-gray-100">HTML Fusion CMH1</h1>
      </div>
      <div className="flex items-center gap-2">
        <button onClick={onToggleTools} className="flex items-center gap-2 px-4 py-2 text-sm font-semibold bg-[#2a2c3d] hover:bg-[#3a3c4d] rounded-md transition-colors text-gray-200">
          <ToolIcon className="w-4 h-4" />
          Tools & Settings
        </button>
        <button onClick={onDownload} className="flex items-center gap-2 px-4 py-2 text-sm font-semibold bg-[#2a2c3d] hover:bg-[#3a3c4d] rounded-md transition-colors text-gray-200">
          <DownloadIcon className="w-4 h-4" />
          Save
        </button>
        <button 
            onClick={onRun}
            className="flex items-center gap-2 px-4 py-2 text-sm font-semibold bg-[#00f5c3] text-[#1a1b26] rounded-md hover:bg-opacity-80 transition-all glow-accent">
          <PlayIcon className="w-4 h-4" />
          Run
        </button>
      </div>
    </header>
  );
});
// END: components/Header.tsx


// START: components/EditorPanel.tsx
const EditorPanel = memo(({ value, onChange, cursorPos, onCursorPosChange, canUndo, onUndo, canRedo, onRedo, onCopy, onClear, onSave, onLoadSample, onSetFullscreen }) => {
  const [lineCount, setLineCount] = useState(1);
  const [fileSize, setFileSize] = useState('0 B');
  const lineNumbersRef = useRef(null);
  const textareaRef = useRef(null);
  const [copied, setCopied] = useState(false);

  useEffect(() => {
    const lines = value.split('\n').length;
    setLineCount(lines);
    
    const size = new Blob([value]).size;
    if (size > 1024 * 1024) {
        setFileSize((size / (1024*1024)).toFixed(2) + ' MB');
    } else if (size > 1024) {
        setFileSize((size / 1024).toFixed(2) + ' KB');
    } else {
        setFileSize(size + ' B');
    }
  }, [value]);

  const handleScroll = () => {
    if (lineNumbersRef.current && textareaRef.current) {
      lineNumbersRef.current.scrollTop = textareaRef.current.scrollTop;
    }
  };

  const handleCursorChange = (target) => {
    const { selectionStart, value } = target;
    const textUpToCursor = value.substring(0, selectionStart);
    const line = textUpToCursor.split('\n').length;
    const col = selectionStart - textUpToCursor.lastIndexOf('\n');
    onCursorPosChange({ line, col });
  };
  
  const handleCopyClick = () => {
    onCopy();
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  }

  return (
    <div className="flex flex-col h-full bg-[#1e1f2b] rounded-lg overflow-hidden border border-[#2a2c3d]">
      <div className="flex items-center justify-between p-2 bg-[#2a2c3d] text-gray-300 text-sm border-b border-[#3a3c4d]">
        <span className="font-semibold px-2">Editor</span>
        <div className="flex items-center gap-1">
           <button title="Undo" onClick={onUndo} disabled={!canUndo} className="disabled:opacity-40 disabled:cursor-not-allowed p-1.5 hover:bg-[#3a3c4d] rounded-md"><HistoryIcon className="w-5 h-5" /></button>
           <button title="Redo" onClick={onRedo} disabled={!canRedo} className="disabled:opacity-40 disabled:cursor-not-allowed p-1.5 hover:bg-[#3a3c4d] rounded-md"><RotateCwIcon className="w-5 h-5" /></button>
           <button title="Copy" onClick={handleCopyClick} className="p-1.5 hover:bg-[#3a3c4d] rounded-md">{copied ? <CheckIcon className="w-5 h-5 text-[#00f5c3]" /> : <CopyIcon className="w-5 h-5" />}</button>
           <button title="Clear" onClick={onClear} className="p-1.5 hover:bg-[#3a3c4d] rounded-md"><Trash2Icon className="w-5 h-5" /></button>
           <button title="Load Sample" onClick={onLoadSample} className="p-1.5 hover:bg-[#3a3c4d] rounded-md"><FileIcon className="w-5 h-5" /></button>
           <button title="Fullscreen" onClick={onSetFullscreen} className="p-1.5 hover:bg-[#3a3c4d] rounded-md"><ExpandIcon className="w-5 h-5" /></button>
        </div>
      </div>
      <div className="flex-grow flex relative overflow-hidden">
        <div ref={lineNumbersRef} className="text-right pr-4 select-none text-gray-500 font-mono text-sm pt-3 pl-3 overflow-y-hidden bg-[#1e1f2b]">
          {Array.from({ length: lineCount }, (_, i) => (
            <div key={i} className="leading-6 h-6">{i + 1}</div>
          ))}
        </div>
        <textarea
          ref={textareaRef}
          value={value}
          onChange={(e) => onChange(e.target.value)}
          onScroll={handleScroll}
          onClick={(e) => handleCursorChange(e.target)}
          onKeyUp={(e) => handleCursorChange(e.target)}
          onSelect={(e) => handleCursorChange(e.target)}
          className="flex-grow h-full resize-none focus:outline-none font-mono text-sm p-3 bg-transparent text-gray-200 leading-6 tracking-wide"
          spellCheck="false"
          wrap="off"
        />
      </div>
       <div className="flex items-center justify-between py-1 px-3 bg-[#2a2c3d] text-gray-400 text-xs border-t border-[#3a3c4d]">
          <div>Ln {cursorPos.line}, Col {cursorPos.col}</div>
          <div>{fileSize}</div>
      </div>
    </div>
  );
});
// END: components/EditorPanel.tsx


// START: components/CustomSelect.tsx
const CustomSelect = ({ options, value, onChange, placeholder = "Select an option" }) => {
    const [isOpen, setIsOpen] = useState(false);
    const selectRef = useRef(null);

    const selectedOption = options.find(option => option.value === value);

    useEffect(() => {
        const handleClickOutside = (event) => {
            if (selectRef.current && !selectRef.current.contains(event.target)) {
                setIsOpen(false);
            }
        };
        document.addEventListener("mousedown", handleClickOutside);
        return () => {
            document.removeEventListener("mousedown", handleClickOutside);
        };
    }, []);

    const handleOptionClick = (optionValue) => {
        onChange(optionValue);
        setIsOpen(false);
    };

    return (
        <div className="relative" ref={selectRef}>
            <button
                type="button"
                onClick={() => setIsOpen(!isOpen)}
                className="flex items-center justify-between w-full p-2 border border-[#3a3c4d] rounded-md text-sm bg-[#2a2c3d] text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#1e1f2b] focus:ring-[#00f5c3]"
                aria-haspopup="listbox"
                aria-expanded={isOpen}
            >
                <span>{selectedOption ? selectedOption.label : placeholder}</span>
                <ChevronDownIcon className={`w-5 h-5 transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} />
            </button>
            {isOpen && (
                <div className="absolute z-10 w-full mt-1 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md shadow-lg max-h-60 overflow-auto" role="listbox">
                    {options.map((option) => (
                        <div
                            key={option.value}
                            onClick={() => handleOptionClick(option.value)}
                            className={`p-2 text-sm cursor-pointer hover:bg-[#3a3c4d] ${option.value === value ? 'bg-[#00f5c3] font-semibold text-[#1a1b26]' : 'text-gray-200'}`}
                            role="option"
                            aria-selected={option.value === value}
                        >
                            {option.label}
                        </div>
                    ))}
                </div>
            )}
        </div>
    );
};
// END: components/CustomSelect.tsx


// START: components/ToolsModal.tsx
const ToolsModal = memo(({
  isOpen,
  onClose,
  onBeautify,
  onMinify,
  onDownload,
  onDecode,
  onEncode,
  autoUpdate,
  onAutoUpdateChange,
  decodingType,
  onDecodingTypeChange,
  encodingType,
  onEncodingTypeChange,
  onTextToHtml,
  randomGeneratorState,
  onRandomGeneratorChange,
  onGenerateRandom,
  onFileUpload,
  onUrlLoad,
  indentSize,
  onIndentSizeChange,
  onExtractIPs,
  onExtractDomains,
  extractionResults,
  onStripHtml,
  onRemoveUrls,
  onRemoveExtraSpaces,
}) => {
    const [activeTab, setActiveTab] = useState('file');
    const fileInputRef = useRef(null);
    const { length, quantity, includeNumeric, includeUppercase, includeLowercase, generatedString, includeSymbols } = randomGeneratorState;
    const [isCopied, setIsCopied] = useState(false);
    const [isIPsCopied, setIsIPsCopied] = useState(false);
    const [isDomainsCopied, setIsDomainsCopied] = useState(false);

    if (!isOpen) return null;

    const handleFileButtonClick = () => fileInputRef.current?.click();
    
    const tabs = [
        { id: 'file', label: 'File', icon: <FileIcon className="w-4 h-4"/> },
        { id: 'format', label: 'Format', icon: <SlidersIcon className="w-4 h-4"/> },
        { id: 'convert', label: 'Convert', icon: <RefreshCwIcon className="w-4 h-4"/> },
        { id: 'extract', label: 'Extract', icon: <TargetIcon className="w-4 h-4"/> },
        { id: 'generate', label: 'Generate', icon: <WandIcon className="w-4 h-4"/> },
    ];
    
    const encodingOptions = [
        { value: "qp-email", label: "Quoted-Printable (Email)" },
        { value: "qp-single", label: "Quoted-Printable (Single Line)" },
        { value: "base64", label: "Base64" },
        { value: "url", label: "URL Encoded" },
    ];

    const decodingOptions = [
        { value: "auto", label: "Auto-Detect" },
        { value: "base64", label: "Base64" },
        { value: "qp", label: "Quoted-Printable" },
    ];

    const { ips: extractedIPs, domains: extractedDomains } = extractionResults || { ips: '', domains: '' };
    const ipCount = extractedIPs ? extractedIPs.split('\n').filter(Boolean).length : 0;
    const domainCount = extractedDomains ? extractedDomains.split('\n').filter(Boolean).length : 0;
    
    const handleCopy = (text, setCopied) => {
        if (!text) return;
        navigator.clipboard.writeText(text);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
    };

    return (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 transition-opacity" onClick={onClose}>
            <div className="bg-[#1e1f2b] border border-[#2a2c3d] rounded-lg shadow-2xl w-full max-w-2xl text-gray-200 flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                <header className="flex items-center justify-between p-4 border-b border-[#2a2c3d]">
                    <h2 className="text-lg font-bold">Tools & Settings</h2>
                    <button onClick={onClose} className="p-1 rounded-full hover:bg-[#2a2c3d]"><XIcon className="w-5 h-5"/></button>
                </header>
                
                <div className="flex p-2 border-b border-[#2a2c3d] overflow-x-auto">
                    {tabs.map(tab => (
                        <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-semibold transition-colors flex-shrink-0 ${activeTab === tab.id ? 'bg-[#00f5c3] text-[#1a1b26]' : 'hover:bg-[#2a2c3d]'}`}>
                            {tab.icon}
                            {tab.label}
                        </button>
                    ))}
                </div>

                <div className="p-6 overflow-y-auto flex-grow">
                    {activeTab === 'file' && (
                        <div className="space-y-4">
                            <h3 className="font-bold text-lg text-gray-100">Load Content</h3>
                            <input type="file" ref={fileInputRef} onChange={onFileUpload} className="hidden" accept=".html,.htm,.txt" />
                            <div className="grid grid-cols-2 gap-4">
                                <button onClick={handleFileButtonClick} className="flex items-center justify-center gap-2 p-3 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors">
                                    <UploadIcon className="w-5 h-5" />
                                    Load from File
                                </button>
                                <button onClick={onUrlLoad} className="flex items-center justify-center gap-2 p-3 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors">
                                    <LinkIcon className="w-5 h-5" />
                                    Load from URL
                                </button>
                            </div>
                        </div>
                    )}
                    {activeTab === 'format' && (
                        <div className="space-y-6">
                            <div>
                                <h3 className="font-bold text-lg text-gray-100">Formatting Tools</h3>
                                <div className="flex items-center justify-between mt-4">
                                    <label className="flex items-center gap-3 cursor-pointer">
                                        <input type="checkbox" checked={autoUpdate} onChange={e => onAutoUpdateChange(e.target.checked)} className="form-checkbox h-4 w-4 bg-[#2a2c3d] border-[#4a4e69] text-[#00f5c3] rounded focus:ring-offset-[#1e1f2b] focus:ring-[#00f5c3]"/>
                                        Auto-update Preview
                                    </label>
                                    <div className="flex items-center gap-2">
                                        <label className="text-sm">Indent:</label>
                                        <select value={indentSize} onChange={e => onIndentSizeChange(Number(e.target.value))} className="p-1.5 border border-[#3a3c4d] rounded-md text-xs bg-[#2a2c3d] text-gray-200">
                                            <option value={2}>2 spaces</option>
                                            <option value={4}>4 spaces</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-4 mt-4">
                                    <button onClick={onBeautify} className="flex items-center justify-center gap-2 w-full p-2.5 bg-[#00f5c3] text-[#1a1b26] rounded-md hover:bg-opacity-80 transition-colors font-semibold"><SlidersIcon className="w-5 h-5" />Beautify HTML</button>
                                    <button onClick={onMinify} className="flex items-center justify-center gap-2 w-full p-2.5 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors font-semibold"><ListMinusIcon className="w-5 h-5" />Minify HTML</button>
                                    <button onClick={onTextToHtml} className="col-span-2 flex items-center justify-center gap-2 w-full p-2.5 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors font-semibold"><TypeIcon className="w-5 h-5" />Convert Plain Text to HTML</button>
                                </div>
                            </div>
                            <div className="border-t border-[#3a3c4d] pt-6">
                                <h3 className="font-bold text-lg text-gray-100 mb-4">Cleanup Tools</h3>
                                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <button onClick={onStripHtml} className="flex items-center justify-center gap-2 w-full p-2.5 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors font-semibold text-center">
                                        <FileTextIcon className="w-5 h-5" />Strip HTML
                                    </button>
                                    <button onClick={onRemoveUrls} className="flex items-center justify-center gap-2 w-full p-2.5 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors font-semibold text-center">
                                        <LinkIcon className="w-5 h-5" />Remove URLs
                                    </button>
                                    <button onClick={onRemoveExtraSpaces} className="flex items-center justify-center gap-2 w-full p-2.5 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors font-semibold text-center">
                                        <ListMinusIcon className="w-5 h-5" />Cleanup Spaces
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    {activeTab === 'convert' && (
                         <div className="space-y-6">
                            <h3 className="font-bold text-lg text-gray-100">Encode / Decode</h3>
                            
                            <div className="flex flex-col gap-2 text-sm">
                                <label className="font-semibold text-gray-300">Decoding Format</label>
                                <CustomSelect
                                    options={decodingOptions}
                                    value={decodingType}
                                    onChange={onDecodingTypeChange}
                                />
                            </div>
                            <button onClick={onDecode} className="flex items-center justify-center gap-2 w-full p-2.5 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors font-semibold">
                                <ToolIcon className="w-5 h-5" />
                                Decode Content
                            </button>
                             
                            <div className="border-t border-[#2a2c3d]"></div>

                            <div className="flex flex-col gap-2 text-sm">
                                <label className="font-semibold text-gray-300">Encoding Format</label>
                                <CustomSelect
                                    options={encodingOptions}
                                    value={encodingType}
                                    onChange={onEncodingTypeChange}
                                />
                            </div>
                            <button onClick={onEncode} className="flex items-center justify-center gap-2 w-full p-2.5 bg-[#00f5c3] text-[#1a1b26] rounded-md hover:bg-opacity-80 transition-colors font-semibold">
                                <UploadIcon className="w-5 h-5" />
                                Encode Content
                            </button>
                        </div>
                    )}
                    {activeTab === 'extract' && (
                        <div className="space-y-6">
                            <div>
                                <h3 className="font-bold text-lg text-gray-100">Extraction Tools</h3>
                                <p className="text-sm text-gray-400 mt-1">Find and list specific data types from the editor's content.</p>
                            </div>
                            
                            <div className="space-y-2">
                                <button onClick={onExtractIPs} className="flex items-center justify-center gap-2 w-full p-2.5 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors font-semibold">
                                    <TargetIcon className="w-5 h-5" /> Extract IP Addresses
                                </button>
                                {extractedIPs && (
                                    <div className="relative mt-2">
                                        <div className="flex justify-between items-center mb-1 text-xs text-gray-400 px-1">
                                            <span>Found {ipCount} unique IP(s)</span>
                                        </div>
                                        <textarea readOnly value={extractedIPs} className="w-full bg-[#1e1f2b] border border-[#3a3c4d] rounded-md p-2 pr-10 text-xs font-mono h-32 resize-y text-gray-300"/>
                                        <button onClick={() => handleCopy(extractedIPs, setIsIPsCopied)} className="absolute right-2 top-8 p-1 text-gray-400 hover:text-white">
                                            {isIPsCopied ? <CheckIcon className="w-5 h-5 text-[#00f5c3]" /> : <CopyIcon className="w-5 h-5" />}
                                        </button>
                                    </div>
                                )}
                            </div>

                            <div className="border-t border-[#3a3c4d]"></div>
                            
                            <div className="space-y-2">
                                <button onClick={onExtractDomains} className="flex items-center justify-center gap-2 w-full p-2.5 bg-[#2a2c3d] border border-[#3a3c4d] rounded-md hover:bg-[#3a3c4d] transition-colors font-semibold">
                                    <GlobeIcon className="w-5 h-5" /> Extract Domain Names
                                </button>
                                {extractedDomains && (
                                <div className="relative mt-2">
                                        <div className="flex justify-between items-center mb-1 text-xs text-gray-400 px-1">
                                            <span>Found {domainCount} unique domain(s)</span>
                                        </div>
                                        <textarea readOnly value={extractedDomains} className="w-full bg-[#1e1f2b] border border-[#3a3c4d] rounded-md p-2 pr-10 text-xs font-mono h-32 resize-y text-gray-300"/>
                                        <button onClick={() => handleCopy(extractedDomains, setIsDomainsCopied)} className="absolute right-2 top-8 p-1 text-gray-400 hover:text-white">
                                            {isDomainsCopied ? <CheckIcon className="w-5 h-5 text-[#00f5c3]" /> : <CopyIcon className="w-5 h-5" />}
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                     {activeTab === 'generate' && (
                         <div className="space-y-6">
                             <h3 className="font-bold text-lg text-gray-100">Random String Generator</h3>
                             <div className="grid grid-cols-2 gap-4">
                                  <div className="space-y-1">
                                      <label htmlFor="rand-quantity" className="font-medium text-sm text-gray-300">Quantity</label>
                                      <input type="number" id="rand-quantity" value={quantity} onChange={e => onRandomGeneratorChange({ ...randomGeneratorState, quantity: Math.max(1, Number(e.target.value)) })} className="p-2 border border-[#3a3c4d] rounded-md w-full bg-[#2a2c3d] text-gray-200"/>
                                  </div>
                                   <div className="space-y-1">
                                      <label htmlFor="rand-length" className="font-medium text-sm text-gray-300">Length</label>
                                      <input type="number" id="rand-length" value={length} onChange={e => onRandomGeneratorChange({ ...randomGeneratorState, length: Math.max(1, Number(e.target.value)) })} className="p-2 border border-[#3a3c4d] rounded-md w-full bg-[#2a2c3d] text-gray-200"/>
                                  </div>
                              </div>
                              <div className="flex flex-col gap-2 mt-2 text-sm">
                                  <label className="flex items-center gap-3 cursor-pointer"><input type="checkbox" checked={includeNumeric} onChange={e => onRandomGeneratorChange({ ...randomGeneratorState, includeNumeric: e.target.checked })} className="form-checkbox h-4 w-4 bg-[#2a2c3d] border-[#4a4e69] text-[#00f5c3] rounded focus:ring-offset-[#1e1f2b] focus:ring-[#00f5c3]"/> Numeric (0-9)</label>
                                  <label className="flex items-center gap-3 cursor-pointer"><input type="checkbox" checked={includeUppercase} onChange={e => onRandomGeneratorChange({ ...randomGeneratorState, includeUppercase: e.target.checked })} className="form-checkbox h-4 w-4 bg-[#2a2c3d] border-[#4a4e69] text-[#00f5c3] rounded focus:ring-offset-[#1e1f2b] focus:ring-[#00f5c3]"/> Uppercase (A-Z)</label>
                                  <label className="flex items-center gap-3 cursor-pointer"><input type="checkbox" checked={includeLowercase} onChange={e => onRandomGeneratorChange({ ...randomGeneratorState, includeLowercase: e.target.checked })} className="form-checkbox h-4 w-4 bg-[#2a2c3d] border-[#4a4e69] text-[#00f5c3] rounded focus:ring-offset-[#1e1f2b] focus:ring-[#00f5c3]"/> Lowercase (a-z)</label>
								  <label className="flex items-center gap-3 cursor-pointer"><input type="checkbox" checked={includeSymbols} onChange={e => onRandomGeneratorChange({ ...randomGeneratorState, includeSymbols: e.target.checked })} className="form-checkbox h-4 w-4 bg-[#2a2c3d] border-[#4a4e69] text-[#00f5c3] rounded focus:ring-offset-[#1e1f2b] focus:ring-[#00f5c3]"/> Symbols (*-$)</label>

                              </div>
                              <button onClick={onGenerateRandom} className="flex items-center justify-center gap-2 w-full mt-2 p-2.5 bg-[#00f5c3] text-[#1a1b26] rounded-md hover:bg-opacity-80 transition-colors font-semibold"><RefreshCwIcon className="w-4 h-4" />Generate</button>
                               {generatedString && (
                                  <div className="relative mt-2">
                                      <textarea readOnly value={generatedString} className="w-full bg-[#2a2c3d] border border-[#3a3c4d] rounded-md p-2 pr-10 text-xs font-mono h-32 resize-y text-gray-300"/>
                                      <button onClick={() => handleCopy(generatedString, setIsCopied)} className="absolute right-2 top-2 p-1 text-gray-400 hover:text-white">
                                          {isCopied ? <CheckIcon className="w-5 h-5 text-[#00f5c3]" /> : <CopyIcon className="w-5 h-5" />}
                                      </button>
                                  </div>
                              )}
                         </div>
                    )}
                </div>
            </div>
        </div>
    );
});
// END: components/ToolsModal.tsx


// START: components/PreviewPanel.tsx
const PreviewPanel = memo(({ htmlContent, onSetFullscreen }) => {
  return (
    <div className="flex flex-col h-full bg-[#1e1f2b] rounded-lg overflow-hidden border border-[#2a2c3d]">
      <div className="flex items-center justify-between p-2 bg-[#2a2c3d] text-gray-300 text-sm border-b border-[#3a3c4d]">
        <h2 className="font-semibold px-2">Output</h2>
        <button title="Fullscreen" onClick={onSetFullscreen} className="p-1.5 hover:bg-[#3a3c4d] rounded-md">
          <ExpandIcon className="w-5 h-5" />
        </button>
      </div>
      <div className="flex-grow bg-white">
        <iframe
          srcDoc={htmlContent}
          title="HTML Preview"
          className="w-full h-full border-0"
          sandbox="allow-scripts allow-same-origin"
        />
      </div>
    </div>
  );
});
// END: components/PreviewPanel.tsx

// START: App.tsx
const App = () => {
  const [htmlContent, _setHtmlContent] = useState(SAMPLE_HTML);
  const [previewContent, setPreviewContent] = useState(SAMPLE_HTML);
  const [autoUpdate, setAutoUpdate] = useState(true);
  const [decodingType, setDecodingType] = useState('auto');
  const [encodingType, setEncodingType] = useState('qp-email');
  const [randomGeneratorState, setRandomGeneratorState] = useState({
      length: 16,
      quantity: 5,
      includeNumeric: true,
      includeUppercase: true,
      includeLowercase: true,
	  includeSymbols: true,
      generatedString: ''
  });
  const [indentSize, setIndentSize] = useState(2);
  const [cursorPos, setCursorPos] = useState({ line: 1, col: 1 });
  const [fullscreen, setFullscreen] = useState('none'); // 'none', 'editor', 'preview'
  const [isToolsOpen, setIsToolsOpen] = useState(false);
  const [extractionResults, setExtractionResults] = useState({ ips: '', domains: '' });

  // Undo/Redo state
  const history = useRef([SAMPLE_HTML]);
  const historyIndex = useRef(0);
  const isTimeTraveling = useRef(false);

  const setHtmlContent = useCallback((content, fromHistory = false) => {
    _setHtmlContent(content);
    if (!fromHistory && !isTimeTraveling.current) {
      const current = history.current[historyIndex.current];
      if (content === current) return;

      if (historyIndex.current < history.current.length - 1) {
        history.current.splice(historyIndex.current + 1);
      }
      history.current.push(content);
      historyIndex.current = history.current.length - 1;
    }
  }, []);

  const handleUndo = useCallback(() => {
    if (historyIndex.current > 0) {
      isTimeTraveling.current = true;
      historyIndex.current--;
      _setHtmlContent(history.current[historyIndex.current]);
      requestAnimationFrame(() => isTimeTraveling.current = false);
    }
  }, []);

  const handleRedo = useCallback(() => {
    if (historyIndex.current < history.current.length - 1) {
      isTimeTraveling.current = true;
      historyIndex.current++;
      _setHtmlContent(history.current[historyIndex.current]);
      requestAnimationFrame(() => isTimeTraveling.current = false);
    }
  }, []);

  const canUndo = historyIndex.current > 0;
  const canRedo = historyIndex.current < history.current.length - 1;

  useEffect(() => {
    const handler = setTimeout(() => {
      setHtmlContent(htmlContent);
    }, 500);
    return () => clearTimeout(handler);
  }, [htmlContent, setHtmlContent]);


  useEffect(() => {
    if (autoUpdate) {
      const timer = setTimeout(() => {
        setPreviewContent(htmlContent);
      }, 300); // Debounce updates
      return () => clearTimeout(timer);
    }
  }, [htmlContent, autoUpdate]);
  
  const handleRun = useCallback(() => setPreviewContent(htmlContent), [htmlContent]);

  const handleClear = useCallback(() => setHtmlContent(''), [setHtmlContent]);
  
  const handleCopyEditor = useCallback(() => navigator.clipboard.writeText(htmlContent), [htmlContent]);
  
  const handleLoadSample = useCallback(() => setHtmlContent(SAMPLE_HTML), [setHtmlContent]);

  const handleFileUpload = useCallback((event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => setHtmlContent(e.target.result);
      reader.readAsText(file);
    }
    event.target.value = null;
    setIsToolsOpen(false);
  }, [setHtmlContent]);

  const handleUrlLoad = useCallback(async () => {
    const url = prompt("Enter URL to fetch HTML from (CORS policies may prevent this):");
    if (!url) return;
    setIsToolsOpen(false);
    try {
      new URL(url); // basic validation
      const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      const text = await response.text();
      setHtmlContent(text);
    } catch (error) {
      alert(`Failed to fetch from URL: ${error.message}`);
    }
  }, [setHtmlContent]);

  const handleBeautify = useCallback(() => {
    try {
        const voidElements = new Set(['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'link', 'meta', 'param', 'source', 'track', 'wbr']);
        let indentLevel = 0;
        
        // Isolate all tags and content onto separate lines.
        const isolated = htmlContent.replace(/(<[^>]+>)/g, '\n$1\n');
        
        const lines = isolated.split('\n');
        const newHtml = [];
        
        for (const line of lines) {
            const trimmed = line.trim();
            if (!trimmed) continue;
            
            // If it's content (not a tag), indent and push.
            if (!trimmed.startsWith('<')) {
                newHtml.push(' '.repeat(indentLevel * indentSize) + trimmed);
                continue;
            }

            // If it's a closing tag, un-indent before adding the line.
            if (trimmed.startsWith('</')) {
                indentLevel = Math.max(0, indentLevel - 1);
            }
            
            newHtml.push(' '.repeat(indentLevel * indentSize) + trimmed);
            
            // If it's an opening tag (but not self-closing, void, comment, or doctype), indent for the next line.
            const tagNameMatch = trimmed.match(/^<([a-zA-Z0-9]+)/);
            if (tagNameMatch && !trimmed.startsWith('</') && !trimmed.startsWith('<!') && !trimmed.endsWith('/>') && !voidElements.has(tagNameMatch[1].toLowerCase())) {
                indentLevel++;
            }
        }
        setHtmlContent(newHtml.join('\n'));
    } catch (error) { 
        console.error("Failed to beautify HTML:", error);
        alert("Could not beautify the HTML. Please check if it's well-formed.");
    }
  }, [htmlContent, indentSize, setHtmlContent]);
  
  const handleTextToHtml = useCallback(() => {
      const text = htmlContent;
      const escapedText = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
      const withBreaks = escapedText.replace(/\r?\n/g, '<br />\n');
      const newHtml = `<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><title>Converted Text</title>
<style>body { font-family: sans-serif; line-height: 1.6; padding: 1.5rem; }</style>
</head>
<body>\n${withBreaks}\n</body>
</html>`;
      setHtmlContent(newHtml);
  }, [htmlContent, setHtmlContent]);

    const handleMinify = useCallback(() => {
        try {
            const protectedTags = ['pre', 'textarea', 'script', 'style'];
            const placeholders = new Map();
            let source = htmlContent;

            // Replace content of protected tags with placeholders
            protectedTags.forEach(tag => {
                const regex = new RegExp(`<${tag}([^>]*)>([\\s\\S]*?)<\\/${tag}>`, 'gi');
                source = source.replace(regex, (match, attributes, content) => {
                    const id = `__HTML_FUSION_PROTECTED_${placeholders.size}__`;
                    placeholders.set(id, content);
                    return `<${tag}${attributes || ''}>${id}</${tag}>`;
                });
            });

            // Minify the rest of the content
            let minified = source
                .replace(/<!--[\s\S]*?-->/g, "")      // Remove HTML comments
                .replace(/\r\n|\n|\r/gm, "")         // Remove newlines
                .replace(/\s{2,}/g, ' ')              // Collapse whitespace
                .replace(/>\s+</g, '><')             // Remove whitespace between tags
                .trim();

            // Restore protected content
            for (const [id, content] of placeholders.entries()) {
                minified = minified.replace(id, content);
            }

            setHtmlContent(minified);
        } catch (error) {
            console.error("Minification failed:", error);
            alert("Could not minify the HTML. An unexpected error occurred.");
        }
    }, [htmlContent, setHtmlContent]);

  const handleDownload = useCallback(() => {
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'index.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, [htmlContent]);
  
  const handleDecodeQP = useCallback(() => {
    try {
        const qpSource = htmlContent.replace(/=\r?\n/g, "");
        const byteParts = [];
        for (let i = 0; i < qpSource.length; i++) {
            if (qpSource[i] === '=' && i + 2 < qpSource.length) {
                const hex = qpSource.substr(i + 1, 2);
                if (/^[A-Fa-f0-9]{2}$/.test(hex)) {
                    byteParts.push(parseInt(hex, 16));
                    i += 2;
                    continue;
                }
            }
            byteParts.push(qpSource.charCodeAt(i) & 0xFF);
        }

        const bytes = new Uint8Array(byteParts);
        try {
            const decoder = new TextDecoder('utf-8', { fatal: true });
            setHtmlContent(decoder.decode(bytes));
        } catch (e) {
            console.warn('UTF-8 decoding failed, falling back to windows-1252.', e);
            try {
                 const decoder = new TextDecoder('windows-1252');
                 setHtmlContent(decoder.decode(bytes));
            } catch (fallbackError) {
                 console.error("Fallback QP decoding failed.", fallbackError);
                 return false;
            }
        }
        return true;
    } catch (error) { 
      console.error("Failed to decode Quoted-Printable:", error);
      return false;
    }
  }, [htmlContent, setHtmlContent]);
  
  const handleDecodeBase64 = useCallback(() => {
      try {
          const base64 = htmlContent.replace(/\s/g, '');
          if (!base64) return true;
          const binaryString = atob(base64);
          const bytes = new Uint8Array(binaryString.length);
          for (let i = 0; i < binaryString.length; i++) {
              bytes[i] = binaryString.charCodeAt(i);
          }
          try {
              const decoder = new TextDecoder('utf-8', { fatal: true });
              setHtmlContent(decoder.decode(bytes));
          } catch(e) {
              console.warn('Base64 to UTF-8 decoding failed, falling back to latin1.', e);
              const decoder = new TextDecoder('latin1');
              setHtmlContent(decoder.decode(bytes));
          }
          return true;
      } catch (error) {
          console.error("Failed to decode Base64:", error);
          return false;
      }
  }, [htmlContent, setHtmlContent]);
  
  const handleDecode = useCallback(() => {
    if (decodingType === 'qp') {
        if (!handleDecodeQP()) alert("Failed to decode as Quoted-Printable. Please check the input format.");
        return;
    }
    
    if (decodingType === 'base64') {
        if (!handleDecodeBase64()) alert("Failed to decode as Base64. The input may not be a valid Base64 string.");
        return;
    }
    
    // Auto-detect logic
    const content = htmlContent.trim();
    if (!content) return;

    const hasQPMarkers = /(?:=[A-F0-9]{2}|=[\r\n]{1,2})/.test(content);
    if (hasQPMarkers) {
        if (handleDecodeQP()) {
            console.log("Auto-detected and decoded as Quoted-Printable.");
            return;
        }
    }
    
    const isPotentiallyBase64 = /^[A-Za-z0-9+/=\s]+$/.test(content);
    const base64Content = content.replace(/\s/g, '');
    if (isPotentiallyBase64 && base64Content.length > 0 && base64Content.length % 4 === 0) {
        if (handleDecodeBase64()) {
            console.log("Auto-detected and decoded as Base64.");
            return;
        }
    }
    
    alert("Could not auto-detect encoding, or decoding failed. Please select a specific format.");
  }, [decodingType, htmlContent, handleDecodeQP, handleDecodeBase64]);

  const handleEncode = useCallback(() => {
      try {
          const text = htmlContent;
          let output = "";
          switch (encodingType) {
              case 'qp-email':
              case 'qp-single': {
                  const encodeOneLine = encodingType === 'qp-single';
                  const MAX_LINE_LENGTH = 76;
                  
                  const bytes = new TextEncoder().encode(text);
                  let line = "";
                  
                  for (let i = 0; i < bytes.length; i++) {
                      const byte = bytes[i];
                      let charToAppend;
                      
                      if (encodeOneLine && (byte === 10 || byte === 13)) {
                          charToAppend = "=" + byte.toString(16).toUpperCase().padStart(2, '0');
                      }
                      else if (!encodeOneLine && byte === 13) {
                          if (bytes[i + 1] === 10) i++;
                          output += line + "\r\n";
                          line = "";
                          continue;
                      }
                      else if (!encodeOneLine && byte === 10) {
                          output += line + "\r\n";
                          line = "";
                          continue;
                      }
                      else if ((byte >= 33 && byte <= 60) || (byte >= 62 && byte <= 126)) {
                          charToAppend = String.fromCharCode(byte);
                      }
                      else if (byte === 32 || byte === 9) {
                           const isLastByte = (i === bytes.length - 1);
                           const nextByteIsNewline = !isLastByte && (bytes[i + 1] === 10 || bytes[i + 1] === 13);
                           
                           if (!encodeOneLine && (isLastByte || nextByteIsNewline)) {
                               charToAppend = "=" + byte.toString(16).toUpperCase().padStart(2, '0');
                           } else {
                               charToAppend = String.fromCharCode(byte);
                           }
                      }
                      else {
                          charToAppend = "=" + byte.toString(16).toUpperCase().padStart(2, '0');
                      }
                      
                      if (!encodeOneLine && (line.length + charToAppend.length > MAX_LINE_LENGTH - 1)) {
                          output += line + "=\r\n";
                          line = "";
                      }
                      
                      line += charToAppend;
                  }
                  
                  output += line;
                  break;
              }
              case 'base64':
                  output = btoa(unescape(encodeURIComponent(text))); 
                  break;
              case 'url': 
                  output = encodeURIComponent(text); 
                  break;
              default: throw new Error(`Unknown encoding type: ${encodingType}`);
          }
          setHtmlContent(output);
      } catch (error) { 
          console.error("Failed to encode:", error);
          alert(`Failed to encode. Error: ${error.message}`); 
      }
  }, [htmlContent, encodingType, setHtmlContent]);
  
  const handleGenerateRandom = useCallback(() => {
      const { length, quantity, includeNumeric, includeUppercase, includeLowercase ,includeSymbols} = randomGeneratorState;
      let charPool = (includeNumeric ? '0123456789' : '') + (includeUppercase ? 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' : '') + (includeLowercase ? 'abcdefghijklmnopqrstuvwxyz' : '')+ (includeSymbols ? '!@#$%^&*()_+[]{}|;:,.<>?/~`' : '');
      if (charPool === '') return alert('Please select at least one character type.');
      const maxCombinations = Math.pow(charPool.length, length);
      if (quantity > maxCombinations) return alert(`Cannot generate ${quantity} unique strings. Max possible: ${Math.floor(maxCombinations)}.`);
      const uniqueStrings = new Set();
      for (let i = 0; i < quantity * 5 && uniqueStrings.size < quantity; i++) {
        let result = '';
        for (let j = 0; j < length; j++) result += charPool[Math.floor(Math.random() * charPool.length)];
        uniqueStrings.add(result);
      }
      setRandomGeneratorState(prev => ({ ...prev, generatedString: Array.from(uniqueStrings).join('\n') }));
  }, [randomGeneratorState]);

  const handleExtractIPs = useCallback(() => {
    const ipRegex = /\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/g;
    const matches = htmlContent.match(ipRegex) || [];
    const uniqueIPs = [...new Set(matches)];
    setExtractionResults(prev => ({ ...prev, ips: uniqueIPs.join('\n') }));
  }, [htmlContent]);

  const handleExtractDomains = useCallback(() => {
      const domainRegex = /(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]/ig;
      const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
      const matches = htmlContent.match(domainRegex) || [];
      const uniqueDomains = [...new Set(matches.map(d => d.toLowerCase()))]
          .filter(domain => !ipRegex.test(domain) && !/^\d+$/.test(domain.replace(/\./g, '')));
      setExtractionResults(prev => ({ ...prev, domains: uniqueDomains.join('\n') }));
  }, [htmlContent]);

  const handleStripHtml = useCallback(() => {
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = htmlContent;
      setHtmlContent(tempDiv.textContent || tempDiv.innerText || '');
  }, [htmlContent, setHtmlContent]);

  const handleRemoveUrls = useCallback(() => {
      const urlRegex = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])|(\bwww\.[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
      setHtmlContent(htmlContent.replace(urlRegex, ''));
  }, [htmlContent, setHtmlContent]);

  const handleRemoveExtraSpaces = useCallback(() => {
      let newContent = htmlContent;
      newContent = newContent.replace(/[ \t]{2,}/g, ' '); // Collapse horizontal whitespace
      newContent = newContent.split('\n').map(line => line.trim()).join('\n'); // Trim each line
      newContent = newContent.replace(/\n{3,}/g, '\n\n'); // Collapse multiple blank lines
      newContent = newContent.trim(); // Trim the whole string
      setHtmlContent(newContent);
  }, [htmlContent, setHtmlContent]);

  // Splitter logic
  const [dividerPos, setDividerPos] = useState(50);
  const mainRef = useRef(null);

  const handleMouseDown = useCallback((e) => {
    // Prevent text selection during drag
    e.preventDefault();
    
    const handleMouseMove = (e) => {
      if (mainRef.current) {
        const rect = mainRef.current.getBoundingClientRect();
        const newPos = ((e.clientX - rect.left) / rect.width) * 100;
        setDividerPos(Math.max(20, Math.min(80, newPos))); // Clamp between 20% and 80%
      }
    };

    const handleMouseUp = () => {
      document.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
    };

    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseup', handleMouseUp);
  }, []);


  if (fullscreen === 'editor') {
    return (
      <div className="h-screen w-screen absolute inset-0 z-50 bg-[#1e1f2b]">
        <div className="flex items-center justify-end p-2 bg-[#2a2c3d]">
            <button title="Exit Fullscreen" onClick={() => setFullscreen('none')} className="p-1.5 text-gray-300 hover:bg-[#3a3c4d] rounded-md"><MinimizeIcon className="w-5 h-5" /></button>
        </div>
        <EditorPanel value={htmlContent} onChange={_setHtmlContent} cursorPos={cursorPos} onCursorPosChange={setCursorPos} canUndo={canUndo} onUndo={handleUndo} canRedo={canRedo} onRedo={handleRedo} onCopy={handleCopyEditor} onClear={handleClear} onSave={handleDownload} onLoadSample={handleLoadSample} onSetFullscreen={() => setFullscreen('none')} />
      </div>
    );
  }
  
  if (fullscreen === 'preview') {
      return (
        <div className="h-screen w-screen absolute inset-0 z-50 bg-[#1e1f2b]">
            <div className="flex items-center justify-end p-2 bg-[#2a2c3d]">
                <button title="Exit Fullscreen" onClick={() => setFullscreen('none')} className="p-1.5 text-gray-300 hover:bg-[#3a3c4d] rounded-md"><MinimizeIcon className="w-5 h-5" /></button>
            </div>
            <PreviewPanel htmlContent={previewContent} onSetFullscreen={() => setFullscreen('none')} />
        </div>
      );
  }


  return (
    <div className="flex flex-col h-screen font-sans bg-[#1a1b26] text-gray-200 overflow-hidden">
      <Header onNew={handleClear} onDownload={handleDownload} onRun={handleRun} onToggleTools={() => setIsToolsOpen(true)} />
      <main ref={mainRef} className="flex-grow flex p-4 gap-4 overflow-hidden relative">
        <div className="h-full" style={{ width: `calc(${dividerPos}% - 8px)` }}>
            <EditorPanel value={htmlContent} onChange={_setHtmlContent} cursorPos={cursorPos} onCursorPosChange={setCursorPos} canUndo={canUndo} onUndo={handleUndo} canRedo={canRedo} onRedo={handleRedo} onCopy={handleCopyEditor} onClear={handleClear} onSave={handleDownload} onLoadSample={handleLoadSample} onSetFullscreen={() => setFullscreen('editor')} />
        </div>
        
        <div onMouseDown={handleMouseDown} className="w-4 h-full absolute top-0 bottom-0 flex items-center justify-center cursor-col-resize group" style={{ left: `calc(${dividerPos}% - 8px)`}}>
            <div className="w-1 h-1/4 bg-[#2a2c3d] rounded-full group-hover:bg-[#00f5c3] transition-colors"></div>
        </div>

        <div className="h-full" style={{ width: `calc(${100 - dividerPos}% - 8px)` }}>
            <PreviewPanel htmlContent={previewContent} onSetFullscreen={() => setFullscreen('preview')} />
        </div>
      </main>
      <ToolsModal 
          isOpen={isToolsOpen}
          onClose={() => setIsToolsOpen(false)}
          onBeautify={handleBeautify}
          onMinify={handleMinify}
          onDownload={handleDownload}
          onDecode={handleDecode}
          onEncode={handleEncode}
          onTextToHtml={handleTextToHtml}
          autoUpdate={autoUpdate}
          onAutoUpdateChange={setAutoUpdate}
          decodingType={decodingType}
          onDecodingTypeChange={setDecodingType}
          encodingType={encodingType}
          onEncodingTypeChange={setEncodingType}
          randomGeneratorState={randomGeneratorState}
          onRandomGeneratorChange={setRandomGeneratorState}
          onGenerateRandom={handleGenerateRandom}
          onFileUpload={handleFileUpload}
          onUrlLoad={handleUrlLoad}
          indentSize={indentSize}
          onIndentSizeChange={setIndentSize}
          onExtractIPs={handleExtractIPs}
          onExtractDomains={handleExtractDomains}
          extractionResults={extractionResults}
          onStripHtml={handleStripHtml}
          onRemoveUrls={handleRemoveUrls}
          onRemoveExtraSpaces={handleRemoveExtraSpaces}
      />
    </div>
  );
};
// END: App.tsx

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
    <App />
);
    </script>
</body>
</html>
<!-- MADE BY AYOUB RHATTOY CMH1 -->